#!/usr/bin/bash

downloadArchive() {
  local type=$1
  local name=$2
  sudo pacman -S --needed --noconfirm base-devel git
  cd ~/Downloads
  curl -O "https://aur.archlinux.org/packages/${type}/${name}/${name}.tar.gz"
  tar -xzf "${name}.tar.gz"
}

removeArchive() {
  local name=$1
  cd ~/Downloads
  rm -rf "${name}"
  rm "${name}.tar.gz"
}

commonProcedure() {
  local type=$1
  local name=$2
  downloadArchive $type $name
  cd ~/Downloads
  cd "${name}"
  makepkg -Asc --needed --noconfirm
  sudo pacman -U --needed --noconfirm ${name}*.pkg.tar.xz
  removeArchive $name
}

installation() {
  case $1 in
    install)
      installation $2
      ;;
    remove)
      sudo pacman -Rsc $2
      ;;
    acroread)
      sudo pacman -S --needed --noconfirm pangox-compat
      downloadArchive 'ac' 'acroread'
      cd ~/Downloads/acroread
      sed 's/pangox-compat/libcanberra/' <PKGBUILD >PKGBUILD.patched
      mv PKGBUILD.patched PKGBUILD
      makepkg -Asc --needed --noconfirm
      sudo pacman -U --needed --noconfirm acroread*.pkg.tar.xz
      removeArchive acroread
      ;;
    broadcom-wl-dkms)
      sudo pacman -Syu --needed linux-headers dkms
      sudo systemctl enable dkms.service
      commonProcedure 'br' 'broadcom-wl-dkms'
      ;;
    dropbox)
      sudo pacman -Syu --needed ufw-extras perl-file-mimeinfo
      commonProcedure 'dr' 'dropbox'
      ;;
    google-chrome-dev)
      commonProcedure 'go' 'google-chrome-dev'
      ;;
    spotify)
      commonProcedure 'li' 'libgcrypt15'
      commonProcedure 'sp' 'spotify'
      ;;
    sublime-text-nightly)
      commonProcedure 'su' 'sublime-text-nightly'
      ;;
    *)
      echo '
 - - - - - - -
| aur  v0.1.1 |
 - - - - - - -

 usage:

  aur [install|remove] program-name
  aur program-name # implicit install


 list of programs:

  acroread                # Adobe Acrobat Reader
  broadcom-wl-dkms        # Broadcom wifi
  dropbox                 # Dropbox client
  google-chrome-dev       # Chrome dev channel
  spotify                 # music baby!
  sublime-text-nightly    # Sublime 3 (requires a valid license)

'
      ;;
  esac
}

installation $1 $2
